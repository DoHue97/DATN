@using ValuesObject
@using BookStore2019.Services
@using BookStore2019.Help;
@model List<OSanPham>
@{
    //Layout = "~/Views/Shared/_Layout.csthml";
    int pages = ViewBag.Page;
    int pageCount = ViewBag.PageCount;
    int pageSize = ViewBag.PageSize;
    int fromAt = ViewBag.FromAt;
    int total = (int)(Math.Ceiling(pageCount / (double)pageSize));
    var key = ViewBag.Key;
    ViewBag.Title = "Kết quả tìm kiếm với từ khóa " + key;
    var list = ViewBag.ListChuDe as List<OChuDe>;
    var listHot = ViewBag.ListHot as List<OSanPham>;

}

@if (Model.Count > 0 && Model != null)
{
<div class="content-top">
    @Html.Partial("Categories")
    
    <div class="col-sm-9 body-content">
        <h1>Có @Model.Count kết quả</h1>
        @*<div class="row">*@
        @if (Model.Count > 0 && Model != null)
        {
            var i = 1;
            foreach (var item in Model)
            {
                <div class="col-12 col-md-4">
                    <a href="@Url.Action("Detail","Sach",new { shortname=item.TenVanTat})" title="@item.TenSanPham">
                        <img src="@Url.Content(item.Anh)" alt="Alternate Text" class="img-fluid" />
                    </a>
                    <h3 class="title_name">@Helper.CutText(item.TenSanPham)</h3>

                    <button type="button" class="btn btn-success" onclick="updateCart('@item.MaSanPham')">
                        <i class="fas fa-cart-plus"></i>
                        @String.Format("{0:#,##0.##}", item.GiaBan) VND
                    </button>
                </div>
            }
        }
        else
        {
            <div>
                <p>Đang cập nhật dữ liệu</p>
            </div>
        }


        @*</div>*@

    </div>
    <div class="pagination">
        <ul class="pagination">
            @if (pageCount > 1)
            {

                for (int i = 1; i <= total; i++)
                {
                    <li class="@(i == pages ? "active" : "")">
                        <a href="@Url.Action("GetAll","Sach",new { page=i})">@i</a>
                    </li>
                }
            }

        </ul>
    </div>
</div>
}
else
{
    <h2>Không có kết quả nào!</h2>
}
    <div class="clearfix"></div>

    <script>
    function updateCart(id) {
        //debugger;
        var quanlity = 1;
        var idpro = id;

            $.ajax({
                url: '@Url.Action("AddToCart", "ProductAction")',
                data: {
                    proid: idpro,
                    quanlity: quanlity
                },
                type: 'post',
                dataType: 'json',
                success: function (data) {
                    debugger;
                    if (data.Success) {
                        if (data.Flag === "0") {
                            var totalItems = 0;
                            for (var i = 0; i < data.Cart.ListItem.length; i++) {
                                var Item = data.Cart.ListItem[i];
                                totalItems += Item.Quantity;
                            }
                            $("#totalItem").text(totalItems);
                            $("#totalItem").load(window.location.href + " #totalItem");
                            //alert("Đã thêm sản phẩm vào giỏ hàng!");
                        } else {
                            alert("Sản phẩm chỉ còn lại");
                        }
                    } else {
                        alert("Thêm sản phẩm thất bại");
                    }
                }
            });
        }
    //$(document).ready(function () {
    //    debugger;

    //}

    </script>