@using BookStore2019.Services
@using ValuesObject
@model OSach
@{
    ViewBag.Title = "Chi tiết sản phẩm " + Model.TenSach;

    var listTacGia = ViewBag.ListTacGia as List<OTacGia>;
    var listImage = ViewBag.ListImages as List<OImageSach>;
    var listOthers = ViewBag.ListOrther as List<OSach>;
}

<div class="content-top">
    @Html.Partial("Categories")
    <div class="col-sm-9">
        <div class="img-product">
            <ul class="slider_pro">
                @if (listImage.Count > 0 && listImage != null)
                {
                    <li>
                        <a href="#">
                            <img src="@Url.Content(Model.Anh)" alt="Alternate Text" class="" height="300" />
                        </a>
                    </li>
                    foreach (var item in listImage)
                    {
                        <li>
                            <a href="#">
                                <img src="@Url.Content(item.DuongDan)" alt="Alternate Text" class="" height="300" />
                            </a>
                        </li>
                    }
                }
                else
                {
                    <li>
                        <a href="#">
                            <img src="@Url.Content(Model.Anh)" alt="Alternate Text" class="" height="300" />
                        </a>
                    </li>
                }

            </ul>

        </div>
        <div class="info-detail">
            <h2>@Model.TenSach</h2>
            @if (Model.IsSach == true)
            {
                <span>
                    Tác giả:
                    @if (listTacGia.Count > 0 && listTacGia != null)
                    {
                        foreach (var item in listTacGia)
                        {
                            <strong><a href="#"> @item.Ten </a></strong>
                        }
                    }
                    else
                    {
                        <strong><a href="#"> Đang cập nhật </a></strong>
                    }
                </span>
                <br />
                <span>Nhà xuất bản: <strong>@Model.TenNXB</strong></span>
            }
            @if (Model.Sale > 0)
            {
                <h4 class="price-old">@String.Format("{0:#,##0.##}", Model.GiaBan) VND</h4>
                <h4 class="price-sale">
                    <strong>

                        @String.Format("{0:#,##0.##}", Model.GiaBan - Model.GiaBan * Model.Sale / 100) VND
                    </strong>
                </h4>

            }
            else
            {
                <h4 class="">@String.Format("{0:#,##0.##}", Model.GiaBan) VND</h4>
            }

            <div class="form-inline quality">
                <input type="hidden" name="idpro" value="@Model.MaSach" />
                <input type="number" name="quality" value="1" min="1" max="100" class=" form-control" />
                <button type="button" class="btn btn-danger" id="addToCart" onclick="updateCart()">
                    <i class="fas fa-cart-plus"></i>
                    Chọn mua
                </button>
            </div>
            <hr />

        </div>
        <div class="clearfix"></div>
        <div class="description-pro">
            <h3>Giới thiệu</h3>
            @MvcHtmlString.Create(Model.MoTa) <br />
        </div>
        <hr />
        <div class="orther_policy">
            <h3>Dịch vụ và khuyến mại liên quan</h3>
            <ul>
                <li>
                    - Hoàn tiền cho khách khi sản phẩm bị lỗi
                </li>
                <li>
                    - Thanh toán khi giao hàng
                </li>
            </ul>
        </div>
        <div class="clearfix"></div>

    </div>
    <div class="clearfix"></div>
    <div class="col-md-12 divOrther">
        <div class="orther_pro">
            <h3>Sản phẩm cùng loại</h3>
            @if (listOthers.Count > 0 && listOthers != null)
            {
                <ul class="slider_orthers">

                    @foreach (var item in listOthers.Take(10))
                    {
                        <li class="item_other">
                            <a href="@Url.Action("Detail", "Sach", new { shortname = item.TenVanTat })">
                                <img src="@Url.Content(item.Anh)" alt="Alternate Text" height="200" />
                            </a>
                        </li>
                    }
                </ul>
            }

        </div>
    </div>
</div>
<div class="clearfix"></div>
<script>
    setAdminCurrentUrl('@Url.Action("Detail", "Sach")', '@Url.Action("GetAll", "Sach")');
</script>
<script>
    $(document).ready(function () {
        $('.slider_pro').bxSlider({
            auto: true,
            adaptiveHeight: true,
            speed: 1000,
            pause: 7000,
            pager: false,
        });
        $('.slider_orthers').bxSlider({
            auto: true,
            adaptiveHeight: true,
            speed: 1000,
            pause: 7000,
            pager: false,
            maxSlides: 6,
            moveSlides: 6,
            slideWidth: 200,
            slideMargin: 5
        });
    });
</script>
<script>
    function updateCart() {
        //debugger;
        var quanlity = $("input[name='quality']").val();
        var idpro = $("input[name='idpro']").val();
        
            $.ajax({
                url: '@Url.Action("AddToCart", "ProductAction")',
                data: {
                    proid: idpro,
                    quanlity: quanlity
                },
                type: 'post',
                dataType: 'json',
                success: function (data) {
                    debugger;
                    if (data.Success) {
                        if (data.Flag === "0") {
                            var totalItems = 0;
                            for (var i = 0; i < data.Cart.ListItem.length; i++) {
                                var Item = data.Cart.ListItem[i];
                                totalItems += i;
                            }
                            $("#totalItem").text(i);
                            alert("Đã thêm sản phẩm vào giỏ hàng!");
                        } else {
                            alert("Sản phẩm chỉ còn lại");
                        }
                    } else {
                        alert("Thêm sản phẩm thất bại");
                    }
                }
            });
        }
    //$(document).ready(function () {
    //    debugger;

    //}

</script>